#
#IP addressing:
#
#
#All Ethernet point-to-point interfaces are /31s.
#
#
#All Loopbacks are /32s.
#
#
#All Ethernet interfaces should have an MTU of 9214.

#Replace your configlet code with the following:
import yaml
from cvplibrary import CVPGlobalVariables, GlobalVariableNames
hostname = "Spine1-DC1"
config = """
Spine1-DC1:
  interfaces:
    Loopback0: 192.168.101.101
    Ethernet2: 192.168.103.1
    Ethernet3: 192.168.103.7
    Ethernet4: 192.168.103.13
    Ethernet5: 192.168.103.19
    Ethernet6: 192.168.103.25
    Ethernet7: 192.168.103.31
  bgp:
    role: spine
    asn: 65100
  
Spine2-DC1:
  interfaces:
    Loopback0: 192.168.101.102
    Ethernet2: 192.168.103.3
    Ethernet3: 192.168.103.9
    Ethernet4: 192.168.103.15
    Ethernet5: 192.168.103.21
    Ethernet6: 192.168.103.27
    Ethernet7: 192.168.103.33
  bgp:
    role: spine
    asn: 65100
  
Spine3-DC1:
  interfaces:
    Loopback0: 192.168.101.103
    Ethernet2: 192.168.103.5
    Ethernet3: 192.168.103.11
    Ethernet4: 192.168.103.17
    Ethernet5: 192.168.103.23
    Ethernet6: 192.168.103.29
    Ethernet7: 192.168.103.35
  bgp:
    role: spine
    asn: 65100

Leaf1-DC1:
  interfaces:
    Loopback0: 192.168.101.11
    Loopback1: 192.168.102.11
    Ethernet3: 192.168.103.0
    Ethernet4: 192.168.103.2
    Ethernet5: 192.168.103.4
  bgp:
    role: leaf
    asn: 65101
    spine-peers:
      - 192.168.103.1
      - 192.168.103.3
      - 192.168.103.5
    iBGP-peer: 192.168.255.2
  
Leaf2-DC1:
  interfaces:
    Loopback0: 192.168.101.12
    Loopback1: 192.168.102.11
    Ethernet3: 192.168.103.6
    Ethernet4: 192.168.103.8
    Ethernet5: 192.168.103.10
  bgp:
    role: leaf
    asn: 65101
    spine-peers:
      - 192.168.103.7
      - 192.168.103.9
      - 192.168.103.11
    iBGP-peer: 192.168.255.1
  
Leaf3-DC1:
  interfaces:
    Loopback0: 192.168.101.13
    Loopback1: 192.168.102.13
    Ethernet3: 192.168.103.12
    Ethernet4: 192.168.103.14
    Ethernet5: 192.168.103.16
  bgp:
    role: leaf
    asn: 65102
    spine-peers:
      - 192.168.103.13
      - 192.168.103.15
      - 192.168.103.17
    iBGP-peer: 192.168.255.2
  
Leaf4-DC1:
  interfaces:
    Loopback0: 192.168.101.14
    Loopback1: 192.168.102.13
    Ethernet3: 192.168.103.18
    Ethernet4: 192.168.103.20
    Ethernet5: 192.168.103.22
  bgp:
    role: leaf
    asn: 65102
    spine-peers:
      - 192.168.103.19
      - 192.168.103.21
      - 192.168.103.23
    iBGP-peer: 192.168.255.1
  
Borderleaf1-DC1:
  interfaces:
    Loopback0: 192.168.101.21
    Loopback1: 192.168.102.21
    Ethernet3: 192.168.103.24
    Ethernet4: 192.168.103.26
    Ethernet5: 192.168.103.28
    Ethernet12: 192.168.254.0
  bgp:
    role: leaf
    asn: 65103
    spine-peers:
      - 192.168.103.25
      - 192.168.103.27
      - 192.168.103.29
    iBGP-peer: 192.168.255.2
  
Borderleaf2-DC1:
  interfaces:
    Loopback: 192.168.102.22
    Loopback1: 192.168.102.21
    Ethernet3: 192.168.103.30
    Ethernet4: 192.168.103.32
    Ethernet5: 192.168.103.34
    Ethernet12: 192.168.254.2
  bgp:
    role: leaf
    asn: 65103
    spine-peers:
      - 192.168.103.31
      - 192.168.103.33
      - 192.168.103.35
    iBGP-peer: 192.168.255.1


Spine1-DC2:
  interfaces:
    Loopback0: 192.168.201.101
    Ethernet2: 192.168.203.1
    Ethernet3: 192.168.203.7
    Ethernet4: 192.168.203.13
    Ethernet5: 192.168.203.19
    Ethernet6: 192.168.203.25
    Ethernet7: 192.168.203.31
bgp:
  role: spine
  asn: 65200
  
Spine2-DC2:
  interfaces:
    Loopback0: 192.168.201.102
    Ethernet2: 192.168.203.3
    Ethernet3: 192.168.203.9
    Ethernet4: 192.168.203.15
    Ethernet5: 192.168.203.21
    Ethernet6: 192.168.203.27
    Ethernet7: 192.168.203.33
bgp:
  role: spine
  asn: 65200
  
Spine3-DC2:
  interfaces:
    Loopback0: 192.168.201.103
    Ethernet2: 192.168.203.5
    Ethernet3: 192.168.203.11
    Ethernet4: 192.168.203.17
    Ethernet5: 192.168.203.23
    Ethernet6: 192.168.203.29
    Ethernet7: 192.168.203.35
bgp:
  role: spine
  asn: 65200

Leaf1-DC2:
  interfaces:
    Loopback0: 192.168.201.11
    Loopback1: 192.168.202.11
    Ethernet3: 192.168.203.0
    Ethernet4: 192.168.203.2
    Ethernet5: 192.168.203.4
  bgp:
    role: leaf
    asn: 65201
    spine-peers:
      - 192.168.203.1
      - 192.168.203.3
      - 192.168.203.5
    iBGP-peer: 192.168.255.2
  
Leaf2-DC2:
  interfaces:
    Loopback0: 192.168.201.12
    Loopback1: 192.168.202.11
    Ethernet3: 192.168.203.6
    Ethernet4: 192.168.203.8
    Ethernet5: 192.168.203.10
  bgp:
    role: leaf
    asn: 65201
    spine-peers:
      - 192.168.203.7
      - 192.168.203.9
      - 192.168.203.11
    iBGP-peer: 192.168.255.1
  
Leaf3-DC2:
  interfaces:
    Loopback0: 192.168.201.13
    Loopback1: 192.168.202.13
    Ethernet3: 192.168.203.12
    Ethernet4: 192.168.203.14
    Ethernet5: 192.168.203.16
  bgp:
    role: leaf
    asn: 65202
    spine-peers:
      - 192.168.203.13
      - 192.168.203.15
      - 192.168.203.17
    iBGP-peer: 192.168.255.2
  
Leaf4-DC2:
  interfaces:
    Loopback0: 192.168.201.14
    Loopback1: 192.168.202.13
    Ethernet3: 192.168.203.18
    Ethernet4: 192.168.203.20
    Ethernet5: 192.168.203.22
  bgp:
    role: leaf
    asn: 65202
    spine-peers:
      - 192.168.203.19
      - 192.168.203.21
      - 192.168.203.23
    iBGP-peer: 192.168.255.1
  
Borderleaf1-DC2:
  interfaces:
    Loopback0: 192.168.201.21
    Loopback1: 192.168.202.21
    Ethernet3: 192.168.203.24
    Ethernet4: 192.168.203.26
    Ethernet5: 192.168.203.2
    Ethernet12: 192.168.254.4
  bgp:
    role: leaf
    asn: 65203
    spine-peers:
      - 192.168.203.2
      - 192.168.203.2
      - 192.168.203.2
    iBGP-peer: 192.168.255.1
  
Borderleaf2-DC2:
  interfaces:
    Loopback0: 192.168.202.2
    Loopback1: 192.168.202.2
    Ethernet3: 192.168.203.3
    Ethernet4: 192.168.203.3
    Ethernet5: 192.168.203.3
    Ethernet12: 192.168.254.6
  bgp:
    role: leaf
    asn: 65203
    spine-peers:
      - 192.168.203.3
      - 192.168.203.3
      - 192.168.203.35
    iBGP-peer: 192.168.255.1

"""

switches = yaml.load(config)

for iface in switches[hostname]['interfaces']:
#Iterate through all interfaces using iface variable as the incrementing index
    print("interface %s") % iface
#Pull variables into easier to use variables
    ip = switches[hostname]['interfaces'][iface]
    if "Ethernet" in iface:
        print " no switchport"
        print " mtu 9214"
        print(" ip address %s" + "/31") % (ip)
    else:
        print(" ip address %s" + "/32") % (ip)
        print(" ")

if "spine" in switches[hostname]['bgp']['role']:
    print(" service routing protocols model multi-agent")
    print(" ip prefix-list LOOPBACK")
    print("   seq 10 permit 192.168.101.0/24 eq 32")
    print("   seq 20 permit 192.168.201.0/24 eq 32")
    print(" route-map LOOPBACK permit 10")
    print("   match ip address prefix-list LOOPBACK")
    print(" peer-filter LEAF-AS-RANGE")
    print("   10 match as-range 65000-65535 result accept")
    print(" router bgp %s") % (switches[hostname]['bgp']['asn'])
    print("   router-id %s") % (switches[hostname]['interfaces']['Loopback0'])
    print("   no bgp default ipv4-unicast")
    print("   maximum-paths 3")
    print("   distance bgp 20 200 200")
    print("   bgp listen range 192.168.0.0/16 peer-group LEAF_Underlay peer-filter LEAF-AS-RANGE")
    print("   neighbor LEAF_Underlay peer group")
    print("   neighbor LEAF_Underlay send-community")
    print("   neighbor LEAF_Underlay maximum-routes 12000")
    print("   redistribute connected route-map LOOPBACK")
    print("   address-family ipv4")
    print("     neighbor LEAF_Underlay activate")
    print("     redistribute connected route-map LOOPBACK")

elif "leaf" in switches[hostname]['bgp']['role']:
    print(" ip prefix-list LOOPBACK")
    print("   seq 10 permit 192.168.101.0/24 eq 32")
    print("   seq 20 permit 192.168.201.0/24 eq 32")
    print(" route-map LOOPBACK permit 10")
    print("   match ip address prefix-list LOOPBACK")
    print(" router bgp %s") % (switches[hostname]['bgp']['asn'])
    print("   router-id %s") % (switches[hostname]['interfaces']['Loopback0'])
    print("   no bgp default ipv4-unicast")
    print("   maximum-paths 3")
    print("   distance bgp 20 200 200")
    print("   neighbor SPINE_Underlay peer group")
    if "DC1" in hostname.split("-",1)[1]:
        print("   neighbor SPINE_Underlay remote-as 65100")
    elif "DC2" in hostname.split("-",1)[1]:
        print("   neighbor SPINE_Underlay remote-as 65200")
    print("   neighbor SPINE_Underlay send-community")
    print("   neighbor SPINE_Underlay maximum-routes 12000")
    print("   neighbor LEAF_Peer peer group")
    print("   neighbor LEAF_Peer remote-as %s") % (switches[hostname]['bgp']['asn'])
    print("   neighbor LEAF_Peer next-hop-self")
    print("   neighbor LEAF_Peer maximum-routes 12000")
    print(" ")
    for peer in switches[hostname]['bgp']['spine-peers']:
        print("   neighbor %s" + " peer group SPINE") % peer
    print("   neighbor %s" + " peer group LEAF_Peer") % switches[hostname]['bgp']['iBGP-peer']
#    print(" ! List the neighbor IPs here. It should be three spines for SPINE_Underlay and one LEAF_Peer")
    print("   redistribute connected route-map LOOPBACK")
    print("   address-family ipv4")
    print("     neighbor SPINE_Underlay activate")
    print("     neighbor LEAF_Peer activate")

